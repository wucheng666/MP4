!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.parseISOFile=e():t.parseISOFile=e()}(window,function(){return i=[function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s(i(2)),n=s(i(4));function s(t){return t&&t.__esModule?t:{default:t}}o.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)},o.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()},o.prototype.parse=function(){var t,e,i=null;if(!this.restoreParsePosition||this.restoreParsePosition())for(;;){if(this.saveParsePosition&&this.saveParsePosition(),(t=n.default.parseOneBox(this.stream,!0)).code===n.default.ERR_NOT_ENOUGH_DATA)return this.stream.seek(0),this.lastBoxStartPosition=0,void("moof"===t.type?(e=this.previousRequestRangeStartIndex+t.start,this.callback({error:{errorCode:n.default.ERR_NOT_ENOUGH_DATA,nextRangeStart:e}}),this.previousRequestRangeStartIndex=e):"mdat"===t.type&&(e=this.previousRequestRangeStartIndex+i.start,this.callback({error:{errorCode:n.default.ERR_NOT_ENOUGH_DATA,nextRangeStart:e}}),this.previousRequestRangeStartIndex=e));this.myBusinessLogic(i,t),i=t}},o.prototype.myBusinessLogic=function(t,e){var i;"moov"===e.type&&this.callback({boxInfo:e,arrayBuffer:this.stream.buffer}),"mdat"===e.type&&(i=t.box.trafs[0].tfhd.track_id,this.callback({boxInfo:{type:"moof_mdat",start:t.start,size:t.size+e.size,trackId:i},arrayBuffer:this.stream.buffer}))},o.prototype.appendBuffer=function(t,e){this.checkBuffer(t)&&(this.parse(),this.stream.cleanBuffers&&(this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)))},o.prototype.checkBuffer=function(t){if(null==t)throw"Buffer must be defined and non empty";if(void 0===t.fileStart)throw"Buffer must have a fileStart property";return 0===t.byteLength?(console.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(console.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),!!this.stream.initialized()||(console.warn("ISOFile","Not ready to start parsing"),!1))},i=o;function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this.stream=new r.default,this.callback=t||function(){},this.moofs=[],this.lastBoxStartPosition=0,this.position=0,this.previousRequestRangeStartIndex=0}i.prototype.discardMdatData=!1,e.default=i,t.exports=e.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,n=i(3),s=(r=n)&&r.__esModule?r:{default:r};var o,i=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,o=s.default),a.prototype.getPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position},a.prototype.getEndPosition=function(){if(-1===this.bufferIndex||null===this.buffers[this.bufferIndex])throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength},a.prototype.findPosition=function(t,e,i){for(var r=null,n=-1,s=!0===t?0:this.bufferIndex;s<this.buffers.length&&(r=this.buffers[s]).fileStart<=e;)n=s,i&&(r.fileStart+r.byteLength<=e?r.usedBytes=r.byteLength:r.usedBytes=e-r.fileStart,this.logBufferLevel()),s++;return-1!==n&&(r=this.buffers[n]).fileStart+r.byteLength>=e?(console.debug("MultiBufferStream","Found position in existing buffer #"+n),n):-1},a.prototype.seek=function(t,e,i){i=this.findPosition(e,t,i);return-1!==i?(this.buffer=this.buffers[i],this.bufferIndex=i,this.position=t-this.buffer.fileStart,console.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(console.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)},a.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var r=this.buffers[i];if(t.fileStart<=r.fileStart){if(t.fileStart===r.fileStart){if(t.byteLength>r.byteLength){this.buffers.splice(i,1),i--;continue}console.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring")}else t.fileStart+t.byteLength<=r.fileStart||(t=this.reduceBuffer(t,0,r.fileStart-t.fileStart)),console.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),0===i&&(this.buffer=t);e=!1;break}if(t.fileStart<r.fileStart+r.byteLength){var n=r.fileStart+r.byteLength-t.fileStart,r=t.byteLength-n;if(!(0<r)){e=!1;break}t=this.reduceBuffer(t,n,r)}}e&&(this.buffers.push(t),0===i&&(this.buffer=t))},a.prototype.logBufferLevel=function(t){for(var e,i,r=[],n="",s=0,o=0,a=0;a<this.buffers.length;a++)e=this.buffers[a],0===a?(r.push(i={}),i.start=e.fileStart,i.end=e.fileStart+e.byteLength,n+="["+i.start+"-"):i.end===e.fileStart?i.end=e.fileStart+e.byteLength:((i={}).start=e.fileStart,n+=r[r.length-1].end-1+"], ["+i.start+"-",i.end=e.fileStart+e.byteLength,r.push(i)),s+=e.usedBytes,o+=e.byteLength;0<r.length&&(n+=i.end-1+"]"),0===this.buffers.length?console.log("MultiBufferStream","No more buffer in memory"):console.log("MultiBufferStream",this.buffers.length+" stored buffer(s) ("+s+"/"+o+" bytes), continuous ranges: "+n)},a.prototype.initialized=function(){var t;return-1<this.bufferIndex||(0<this.buffers.length?0===(t=this.buffers[0]).fileStart?(this.buffer=t,this.bufferIndex=0,console.debug("MultiBufferStream","Stream ready for parsing"),!0):(console.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1):(console.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1))},a.prototype.cleanBuffers=function(){for(var t=0;t<this.buffers.length;t++)this.buffers[t],this.buffers.splice(t,1),t--},a);function a(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,o.call(this,new ArrayBuffer,0,s.default.BIG_ENDIAN));return e.buffers=[],e.bufferIndex=-1,t&&(e.insertBuffer(t),e.bufferIndex=0),e}e.default=i,t.exports=e.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var n=Math.pow(2,32),s=(o.prototype.getPosition=function(){return this.position},o.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i)e>this._byteLength&&(this._byteLength=e);else{for(i<1&&(i=1);i<e;)i*=2;var r=new ArrayBuffer(i),t=new Uint8Array(this._buffer);new Uint8Array(r,0,t.length).set(t),this.buffer=r,this._byteLength=e}}},o.prototype._trimAlloc=function(){var t,e,i;this._byteLength!=this._buffer.byteLength&&(t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length),e.set(i),this.buffer=t)},o.prototype.seek=function(t){t=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(t)||!isFinite(t)?0:t},o.prototype.isEof=function(){return this.position>=this._byteLength},o.prototype.mapUint8Array=function(t){this._realloc(+t);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=+t,e},o.prototype.readInt32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Int32Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readInt16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Int16Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readInt8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Int8Array(t);return o.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},o.prototype.readUint32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Uint32Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readUint16Array=function(t,e){t=null==t?this.byteLength-this.position/2:t;var i=new Uint16Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readUint8Array=function(t){t=null==t?this.byteLength-this.position:t;var e=new Uint8Array(t);return o.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e},o.prototype.readFloat64Array=function(t,e){t=null==t?this.byteLength-this.position/8:t;var i=new Float64Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readFloat32Array=function(t,e){t=null==t?this.byteLength-this.position/4:t;var i=new Float32Array(t);return o.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),o.arrayToNative(i,null==e?this.endianness:e),this.position+=i.byteLength,i},o.prototype.readInt32=function(t){t=this._dataView.getInt32(this.position,null==t?this.endianness:t);return this.position+=4,t},o.prototype.readInt16=function(t){t=this._dataView.getInt16(this.position,null==t?this.endianness:t);return this.position+=2,t},o.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t},o.prototype.readUint32=function(t){t=this._dataView.getUint32(this.position,null==t?this.endianness:t);return this.position+=4,t},o.prototype.readUint16=function(t){t=this._dataView.getUint16(this.position,null==t?this.endianness:t);return this.position+=2,t},o.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t},o.prototype.readFloat32=function(t){t=this._dataView.getFloat32(this.position,null==t?this.endianness:t);return this.position+=4,t},o.prototype.readFloat64=function(t){t=this._dataView.getFloat64(this.position,null==t?this.endianness:t);return this.position+=8,t},o);function o(t,e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:"object"==(void 0===t?"undefined":r(t))?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=null==i?o.LITTLE_ENDIAN:i}s.prototype.BIG_ENDIAN=!1,s.prototype.LITTLE_ENDIAN=!0,s.prototype._byteLength=0,Object.defineProperty(s.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}}),Object.defineProperty(s.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}}),Object.defineProperty(s.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}}),s.prototype.failurePosition=0,String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)},s.endianness=0<new Int8Array(new Int16Array([1]).buffer)[0],s.memcpy=function(t,e,i,r,n){e=new Uint8Array(t,e,n),n=new Uint8Array(i,r,n);e.set(n)},s.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)},s.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)},s.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var r=i+t.BYTES_PER_ELEMENT-1,n=i;n<r;r--,n++){var s=e[n];e[n]=e[r],e[r]=s}return t},s.prototype.readString=function(t,e){return null==e||"ASCII"==e?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(null==t?this.byteLength-this.position:t)]):new TextDecoder(e).decode(this.mapUint8Array(t))},s.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),r=e;null!=t&&(r=Math.min(t,e));for(var n=0;n<r&&0!==i[n];n++);var s=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(n)]);return null!=t?this.position+=r-n:n!=e&&(this.position+=1),s},s.prototype.readInt64=function(){return this.readInt32()*n+this.readUint32()},s.prototype.readUint64=function(){return this.readUint32()*n+this.readUint32()},s.prototype.readInt64=function(){return this.readUint32()*n+this.readUint32()},s.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()},e.default=s,t.exports=e.default},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});function h(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h)}h.ERR_INVALID_DATA=-1,h.ERR_NOT_ENOUGH_DATA=0,h.OK=1,h.BASIC_BOXES=["mdat","idat","free","skip","meco","strk"],h.FULL_BOXES=["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],h.CONTAINER_BOXES=[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],h.boxCodes=[],h.fullBoxCodes=[],h.containerBoxCodes=[],h.sampleEntryCodes={},h.sampleGroupEntryCodes=[],h.trackGroupTypes=[],h.UUIDBoxes={},h.UUIDs=[],h.initialize=function(){h.FullBox.prototype=new h.Box,h.ContainerBox.prototype=new h.Box,h.SampleEntry.prototype=new h.Box,h.TrackGroupTypeBox.prototype=new h.FullBox,h.BASIC_BOXES.forEach(function(t){h.createBoxCtor(t)}),h.FULL_BOXES.forEach(function(t){h.createFullBoxCtor(t)}),h.CONTAINER_BOXES.forEach(function(t){h.createContainerBoxCtor(t[0],null,t[1])})},h.Box=function(t,e,i){this.type=t,this.size=e,this.uuid=i},h.FullBox=function(t,e,i){h.Box.call(this,t,e,i),this.flags=0,this.version=0},h.ContainerBox=function(t,e,i){h.Box.call(this,t,e,i),this.boxes=[]},h.SampleEntry=function(t,e,i,r){h.ContainerBox.call(this,t,e),this.hdr_size=i,this.start=r},h.SampleGroupEntry=function(t){this.grouping_type=t},h.TrackGroupTypeBox=function(t,e){h.FullBox.call(this,t,e)},h.createBoxCtor=function(e,t){h.boxCodes.push(e),(h[e+"Box"]=function(t){h.Box.call(this,e,t)}).prototype=new h.Box,t&&(h[e+"Box"].prototype.parse=t)},h.createFullBoxCtor=function(e,i){(h[e+"Box"]=function(t){h.FullBox.call(this,e,t)}).prototype=new h.FullBox,h[e+"Box"].prototype.parse=function(t){this.parseFullHeader(t),i&&i.call(this,t)}},h.addSubBoxArrays=function(t){if(t)for(var e=(this.subBoxNames=t).length,i=0;i<e;i++)this[t[i]+"s"]=[]},h.createContainerBoxCtor=function(e,t,i){(h[e+"Box"]=function(t){h.ContainerBox.call(this,e,t),h.addSubBoxArrays.call(this,i)}).prototype=new h.ContainerBox,t&&(h[e+"Box"].prototype.parse=t)},h.createMediaSampleEntryCtor=function(t,e,i){h.sampleEntryCodes[t]=[],(h[t+"SampleEntry"]=function(t,e){h.SampleEntry.call(this,t,e),h.addSubBoxArrays.call(this,i)}).prototype=new h.SampleEntry,e&&(h[t+"SampleEntry"].prototype.parse=e)},h.createSampleEntryCtor=function(e,i,t,r){h.sampleEntryCodes[e].push(i),(h[i+"SampleEntry"]=function(t){h[e+"SampleEntry"].call(this,i,t),h.addSubBoxArrays.call(this,r)}).prototype=new h[e+"SampleEntry"],t&&(h[i+"SampleEntry"].prototype.parse=t)},h.createEncryptedSampleEntryCtor=function(t,e,i){h.createSampleEntryCtor.call(this,t,e,i,["sinf"])},h.createSampleGroupCtor=function(e,t){(h[e+"SampleGroupEntry"]=function(t){h.SampleGroupEntry.call(this,e,t)}).prototype=new h.SampleGroupEntry,t&&(h[e+"SampleGroupEntry"].prototype.parse=t)},h.createTrackGroupCtor=function(e,t){(h[e+"TrackGroupTypeBox"]=function(t){h.TrackGroupTypeBox.call(this,e,t)}).prototype=new h.TrackGroupTypeBox,t&&(h[e+"TrackGroupTypeBox"].prototype.parse=t)},h.createUUIDBox=function(e,i,r,n){h.UUIDs.push(e),h.UUIDBoxes[e]=function(t){(i?h.FullBox:r?h.ContainerBox:h.Box).call(this,"uuid",t,e)},h.UUIDBoxes[e].prototype=new(i?h.FullBox:r?h.ContainerBox:h.Box),n&&(h.UUIDBoxes[e].prototype.parse=i?function(t){this.parseFullHeader(t),n&&n.call(this,t)}:n)},h.initialize(),h.parseOneBox=function(t,e,i){var r,n=t.getPosition(),s=0;if(t.getEndPosition()-n<8)return console.log("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:h.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return console.log("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:h.ERR_NOT_ENOUGH_DATA};var o=t.readUint32(),a=t.readString(4),f=a,s=8;if("uuid"==a){if(t.getEndPosition()-t.getPosition()<16||i-s<16)return t.seek(n),console.log("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:h.ERR_NOT_ENOUGH_DATA};s+=16,f=h.parseUUID(t)}if(1==o){if(t.getEndPosition()-t.getPosition()<8||i&&i-s<8)return t.seek(n),console.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+a+'" box'),{code:h.ERR_NOT_ENOUGH_DATA};o=t.readUint64(),s+=8}else if(0===o)if(i)o=i;else if("mdat"!==a)return console.error("BoxParser","Unlimited box size not supported for type= '"+a+"'"),r=new h.Box(a,o),{code:h.OK,box:r,size:r.size};if(o<s)return console.error("BoxParser","Box of type "+a+" has an invalid size "+o+" (too small to be a box)"),{code:h.ERR_NOT_ENOUGH_DATA,type:a,size:o,hdr_size:s,start:n};if(i&&i<o)return console.error("BoxParser","Box of type '"+a+"' has a size "+o+" greater than its container size "+i),{code:h.ERR_NOT_ENOUGH_DATA,type:a,size:o,hdr_size:s,start:n};if(n+o>t.getEndPosition())return t.seek(n),console.info("BoxParser","Not enough data in stream to parse the entire '"+a+"' box"),{code:h.ERR_NOT_ENOUGH_DATA,type:a,size:o,hdr_size:s,start:n};return["moov","trak","tkhd","moof","traf","tfhd","meta","xml "].includes(a)&&((r=new h[a+"Box"](o)).hdr_size=s,r.start=n,"xml "===a&&(console.info("BoxParser","'"+f+"' box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t)),t.position=n+o,{code:h.OK,type:a,size:o,hdr_size:s,start:n,box:r}},h.ContainerBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;)(i=h.parseOneBox(t,!1,this.size-(t.getPosition()-this.start))).box&&i.code===h.OK&&(e=i.box,this.boxes.push(e),this.subBoxNames&&-1!=this.subBoxNames.indexOf(e.type)?this[this.subBoxNames[this.subBoxNames.indexOf(e.type)]+"s"].push(e):this[i="uuid"!==e.type?e.type:e.uuid]?console.warn("Box of type "+i+" already stored in field of this type"):this[i]=e)},h.createBoxCtor("ftyp",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;4<=e;)this.compatible_brands[i]=t.readString(4),e-=4,i++}),h.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()}),h.createFullBoxCtor("sdtp",function(t){var e,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var r=0;r<i;r++)e=t.readUint8(),this.is_leading[r]=e>>6,this.sample_depends_on[r]=e>>4&3,this.sample_is_depended_on[r]=e>>2&3,this.sample_has_redundancy[r]=3&e}),h.createFullBoxCtor("tfdt",function(t){1==this.version?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()}),h.createFullBoxCtor("tfhd",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&h.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&h.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&h.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&h.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&h.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0}),h.createFullBoxCtor("trun",function(t){var e=0;if(this.sample_count=t.readUint32(),this.size-this.hdr_size>(e+=4)&&this.flags&h.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&h.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&h.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&h.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&h.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&h.TRUN_FLAGS_CTS_OFFSET&&(0===this.version?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())}),h.createFullBoxCtor("tkhd",function(t){1==this.version?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()}),h.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4},h.createFullBoxCtor("meta",function(t){this.boxes=[],h.ContainerBox.prototype.parse.call(this,t)}),h.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size},h.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size},e.default=h,t.exports=e.default}],r={},n.m=i,n.c=r,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0);function n(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,n),e.l=!0,e.exports}var i,r});